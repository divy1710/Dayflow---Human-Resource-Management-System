generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    HR
    EMPLOYEE
}

enum LeaveStatus {
    PENDING
    APPROVED
    REJECTED
}

enum LeaveType {
    PAID
    SICK
    UNPAID
    CASUAL
}

enum AttendanceStatus {
    PRESENT
    ABSENT
    HALF_DAY
    LEAVE
}

model User {
    id         String   @id @default(cuid())
    employeeId String   @unique
    email      String   @unique
    password   String
    role       Role     @default(EMPLOYEE)
    isVerified Boolean  @default(false)
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    profile       Profile?
    attendances   Attendance[]
    leaveRequests LeaveRequest[]
    salary        Salary?

    @@map("users")
}

model Profile {
    id             String    @id @default(cuid())
    userId         String    @unique
    firstName      String
    lastName       String
    phone          String?
    address        String?
    city           String?
    state          String?
    country        String?
    zipCode        String?
    dateOfBirth    DateTime?
    profilePicture String?

    // Job Details
    department     String?
    designation    String?
    joiningDate    DateTime?
    employmentType String? // Full-time, Part-time, Contract

    // Documents
    documents Document[]

    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("profiles")
}

model Document {
    id        String   @id @default(cuid())
    profileId String
    name      String
    type      String
    url       String
    profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())

    @@map("documents")
}

model Attendance {
    id        String           @id @default(cuid())
    userId    String
    date      DateTime
    checkIn   DateTime?
    checkOut  DateTime?
    status    AttendanceStatus @default(PRESENT)
    workHours Float?
    notes     String?

    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, date])
    @@map("attendances")
}

model LeaveRequest {
    id        String      @id @default(cuid())
    userId    String
    leaveType LeaveType
    startDate DateTime
    endDate   DateTime
    reason    String?
    status    LeaveStatus @default(PENDING)

    // Approval details
    approvedBy String?
    approvedAt DateTime?
    comments   String?

    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("leave_requests")
}

model Salary {
    id               String @id @default(cuid())
    userId           String @unique
    basicSalary      Float
    allowances       Float  @default(0)
    deductions       Float  @default(0)
    netSalary        Float
    currency         String @default("USD")
    paymentFrequency String @default("MONTHLY") // MONTHLY, WEEKLY, BI_WEEKLY

    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("salaries")
}

model LeaveBalance {
    id        String    @id @default(cuid())
    userId    String
    leaveType LeaveType
    total     Int
    used      Int       @default(0)
    remaining Int
    year      Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, leaveType, year])
    @@map("leave_balances")
}
